## 캐시 메모리
### Cache Memory의 역할은 무엇인가
CPU가 메모리에 접근하는 시간은 CPU의 연산 속도에 비해 느리다. 캐시 메모리는 이러한 문제를 해결해준다. (즉, `CPU의 연산 속도`와 `메모리 접근 속도`의 차이를 조금이나마 줄이기 위해 탄생했다.)
![이미지](https://glib-coffee-840.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F70d90254-d045-4fee-a2e5-1e2871afb357%2F53e93352-60d6-4f16-bdf3-9e27d4504f12%2F%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-31_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.35.00.png?table=block&id=2b511ac9-64a9-4f97-8762-d117972e4068&spaceId=70d90254-d045-4fee-a2e5-1e2871afb357&width=2000&userId=&cache=v2)

### 캐시 메모리와 주기억장치의 차이점에 대해 설명해 주세요
주기억장치 (RAM과 ROM이 있지만, 보통 RAM)는 `현재 실행하는 프로그램에 대한  내용`이 저장되며, CPU는 프로그램을 실행하는 과정에서 메모리 (주기억장치)에 저장된 데이터를 빈번하게 사용한다. (한번에 전부 사용하지는 않기에 여러 번 접근하게 된다.)

캐시 메모리는 `CPU가 자주 사용할 내용`을 주기억장치에서 가져와 최대한 CPU가 메모리 (주기억장치)에 접근하는 횟수를 줄이도록 도와준다.

### 캐시 메모리의 상세 구조
캐시 메모리는 L1 캐시, L2 캐시, L3 캐시로 나타낼 수 있다.
![이미지](https://glib-coffee-840.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F70d90254-d045-4fee-a2e5-1e2871afb357%2F75ca50c4-1c37-4aea-b976-0b9c87f4df3e%2F%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-31_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.35.56.png?table=block&id=63438405-2309-4311-9641-bcbefc7da5fe&spaceId=70d90254-d045-4fee-a2e5-1e2871afb357&width=2000&userId=&cache=v2)

L1 캐시, L2 캐시, L3 캐시로 갈 수록 용량이 커지는 반면, 속도는 느려진다.

만약 `멀티 코어 프로세서` 환경이라면, L1 캐시와 L2 캐시는 코어마다 고유한 캐시 메모리로 할당되고, L3 캐시는 여러 코어가 공유하는 형태로 사용된다.
![이미지](https://glib-coffee-840.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F70d90254-d045-4fee-a2e5-1e2871afb357%2Fe33f9e5c-9218-4a1d-a322-f95c9854a9c8%2F%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-31_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_2.37.25.png?table=block&id=596493aa-18db-47f6-9803-b6abcd9808d9&spaceId=70d90254-d045-4fee-a2e5-1e2871afb357&width=2000&userId=&cache=v2)

각 코어에 있는 L1, L2 캐시의 내용은 CPU에 의해 서로 달라질 수 있다. 때문에 이들 간의 싱크를 맞추는 작업이 중요하다.

L1 캐시는 조금이라도 접근 속도를 빠르게 만들기 위해 명령어만을 저장하는 L1I (Instruction) 캐시와 데이터만을 저장하는 L1D (Data) 캐시로 분리하기도 하는데, 이를 `분리형 캐시 (split cache)`라 한다.
### Caching Locality와 Cache Hit Ratio에 대해 설명하시오
캐시의 목적에 맞게 사용하려면, 결국 CPU가 자주 사용할법한 내용을 미리 예측한 뒤 그것을 가져오게 해야 한다.

이 때 `참조 지역성의 원리`에 의거하여 가져오게 된다.
1. CPU는 최근에 접근했던 메모리 공간에 다시 접근하려는 경향이 있다.
2. CPU는 접근한 메모리 공간 근처를 접근하려는 경향이 있다.

첫 번째 원리를 `시간 지역성 (temporal locality)`, 두 번째 원리를 `공간 지역성 (spatial locality)`이라고 한다.

시간 지역성의 대표적인 예로는 `변수`를 들 수 있다. 우리가 프로그램의 코드를 작성할 때 쓰인 변수는 프로그램이 실행되는 동안 계속 쓸 수 있으며, 변수는 특정한 공간을 차지하기 때문이다.

공간 지역성의 대표적인 예로는 워드 프로그램의 `입력 기능`이라고 할 수 있다. CPU가 실행하려는 프로그램들은 관련 데이터들끼리 한데 모여 있는 경향이 있는데, 워드 프로그램의 경우 입력 기능, 출력 기능 등이 있을 때 이 기능들은 서로  관련 있는 것들끼리 모여서 저장된다. 사용자가 입력을 할 때는 입력 기능이 모여 있는 공간 근처를 집중적으로 접근하기에, 이 원리로 CPU가 사용할 데이터를 예측한다.

`Cache Hit Ratio (캐시 적중률)`는 `캐시가 히트되는 비율`을 뜻한다. 위에서 예측하여 가져온 데이터를 CPU가 실제로 사용할 경우 `캐시 히트 (cache hit)`라 하고, 그 반대의 경우를 `캐시 미스 (cache miss)`라고 한다. 즉, 캐시 적중률은 `캐시 히트 횟수 / (캐시 히트 횟수 + 캐시 미스 횟수)`로 구할 수 있다.

### Caching Line
캐시가 메모리에 비해 CPU와 가깝게 위치하지만, 그럼에도 만약 CPU가 원하는 데이터가 캐시의 어느 곳에 저장되어 있는지 찾기 어렵다면 캐시의 장점을 활용하기 어려워진다. 따라서 `캐시는 특정 자료구조를 이용해 데이터를 저장`해두며, 이를 `캐싱 라인 (Caching Line)`이라 한다. 캐싱 라인은 일종의 `블록화된 캐시 묶음`이다.

#### Direct Mapping
* 메모리를 일정한 크기의 블록으로 나누어 각각의 블록을 캐시의 정해진 위치에 매핑하는 방식
* 가장 간단, 구현 쉬움
* 적중률 (Hit rate)이 낮을 수 있음
* 동일한 캐시 메모리에 할당된 여러 데이터를 사용했을 때 충돌 발생 (메모리 블록의 갯수가 캐싱 라인의 캐시 블록 갯수보다 많을 경우 등)
#### Full Associative Mapping
* 캐시 메모리의 빈 공간에 마음대로 주소를 저장
* 저장 간단
* 원하는 데이터가 있는지 조회할 때 모든 태그를 병렬적으로 검사해야 함 - 복잡, 비용 높음
  * 태그: 데이터의 메모리 주소를 기록해둔 것
  * CPU에서 특정 메모리 주소에 해당되는 데이터를 가져오려면 빈 공간에 마음대로 저장했었으므로 캐시 라인 안에 있는 모든 캐시 블록이 탐색 대상이 되는 것이다.
#### Set Associative Mapping
* 위의 두 방식의 장점을 결합
* 빈 공간에 마음대로 주소를 저장하되 미리 정해둔 특정 행에만 저장
* Direct에 비해 검색 느림, 저장 빠름
* Full에 비해 저장 느림, 검색 빠름
* 주로 사용하는 방식
## Reference
* [혼자 공부하는 컴퓨터구조+운영체제](https://hongong.hanbit.co.kr/%EC%BB%B4%ED%93%A8%ED%84%B0-%EA%B5%AC%EC%A1%B0-%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C/)
* [캐시메모리와 지역성 그리고 캐시라인](https://chogyujin-study.tistory.com/106)
